<div id="mobile-sidebar" class="fixed inset-0 z-[100] hidden">
    <div id="sidebar-overlay" class="absolute inset-0 bg-slate-900/40 transition-opacity duration-300 ease-out opacity-0"></div>
    
    <div id="sidebar-panel" class="absolute right-0 top-0 bottom-0 w-[280px] bg-white flex flex-col shadow-xl translate-x-full transition-transform duration-300 ease-out">
        
        <div class="flex items-center justify-between p-6 border-b border-slate-50">
            <span class="text-xs font-bold text-green-900 uppercase tracking-widest">Menu</span>
            <button class="p-2 -mr-2 text-slate-400" id="btn-close-sidebar">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>

        <div class="flex-1 overflow-y-auto p-6 flex flex-col gap-4">
             <nav class="flex flex-col gap-2">
                <a href="{% url 'home' %}" class="px-5 py-4 rounded-xl font-bold no-underline {% if request.resolver_match.url_name == 'home' %}bg-green-900 text-white{% else %}text-slate-600 hover:bg-slate-50{% endif %}">Beranda</a>
                <a href="{% url 'book_list' %}" class="px-5 py-4 rounded-xl font-bold no-underline {% if request.resolver_match.url_name == 'book_list' %}bg-green-900 text-white{% else %}text-slate-600 hover:bg-slate-50{% endif %}">List Buku</a>
            </nav>
        </div>
        
        <div class="p-6 border-t bg-slate-50">
            {% if user.is_authenticated %}
                <button class="w-full py-3 bg-red-50 text-red-600 rounded-xl font-bold text-sm">Logout</button>
            {% else %}
                <a href="{% url 'login' %}" class="block w-full py-4 bg-green-900 text-white text-center rounded-xl font-bold no-underline">Masuk</a>
            {% endif %}
        </div>
    </div>
</div>

<script>
    const sidebarWrapper = document.getElementById('mobile-sidebar');
    const sidebarPanel = document.getElementById('sidebar-panel');
    const sidebarOverlay = document.getElementById('sidebar-overlay');
    const btnOpen = document.getElementById('btn-open-sidebar');
    const btnClose = document.getElementById('btn-close-sidebar');

    function openSidebar() {
        // 1. Tampilkan wrapper dulu
        sidebarWrapper.classList.remove('hidden');
        
        // 2. Gunakan requestAnimationFrame agar browser sempat bernafas
        requestAnimationFrame(() => {
            sidebarOverlay.classList.add('opacity-100');
            sidebarPanel.classList.remove('translate-x-full');
            // Jika ingin pakai blur, tambahkan di sini secara terpisah
            sidebarOverlay.classList.add('backdrop-blur-sm'); 
        });

        document.body.style.overflow = 'hidden';
    }

    function closeSidebar() {
        sidebarOverlay.classList.remove('opacity-100', 'backdrop-blur-sm');
        sidebarPanel.classList.add('translate-x-full');
        
        // Tunggu transisi selesai sebelum hidden
        setTimeout(() => {
            sidebarWrapper.classList.add('hidden');
        }, 300); // Harus sama dengan duration-300 di class HTML
        
        document.body.style.overflow = '';
    }

    btnOpen.onclick = openSidebar;
    btnClose.onclick = closeSidebar;
    sidebarOverlay.onclick = closeSidebar;
</script>
